<!DOCTYPE html>
<html>
  <head>
    <title>Choose.</title>

    <style>
        body {
            width: 90%;
            max-width: 900px;
            margin: 2em auto;
            font: .9em/1.2 Arial, Helvetica, sans-serif;
        }
        .container > div {
            border-radius: 5px;
            padding: 10px;
            background-color: rgb(207,232,220);
            border: 2px solid rgb(79,185,227);
            /*
            display: grid;
            grid-template-columns: 200px 200px 200px; 
             */
        }

        img {
            max-width: 100%
        }
    </style>
  </head>
  <body>
    <div class="container">
      <div>
        <h1>Choose.</h1>
      </div>
      <div id="image-title"></div>
      <div>
        <label for="choice">Enter your choice:</label>
        <input type="text" id="choice" name="choice">
        <label for="choice">yyyy-mm</label>
        <input type="text" id="yyyymm" name="yyyymm">
        <button id="submit" onclick="submitChoice()">Submit</button>
        <button id="next" onclick="displayNextImage()">Fetch Next</button>
      </div>
      <div id="response-field"></div>
      <div id="image-container"></div>
      <div>
          hmm
      </div>
    </div>
    <script>
      // Get a reference to the image container
      const imageContainer = document.getElementById("image-container");
      const imageTitle = document.getElementById("image-title");
      const yyyyMMContainer = document.getElementById("yyyymm");
      const choiceContainer = document.getElementById("choice");
      const localDir = "file:///Users/michal/Dropbox/myphotos/2019/2019-04";
      const responseField = document.getElementById("response-field");

      // Create a function to display the next image
      async function displayNextImage() {
        const response = await fetch("http://127.0.0.1:5000/", {
            mode: "cors", // dont use "no-cors" !
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json',
            },
        });
        console.log(response);

        const jsonData = await response.json();
        console.log(jsonData);
        console.log("sent GET");

        // Check if there are no more images to display
        if ("filename" in jsonData) {
          imageTitle.innerHTML = `<p>${jsonData.filename}</p>`;
        };

        // Display the image
        const imageUrl = `${localDir}/${jsonData.filename}`;
        console.log("imageUrl" + imageUrl);
        imageContainer.innerHTML = `<img src="${imageUrl}" alt="${jsonData.filename}">`;
        responseField.innerHTML = `<p>${jsonData.message}</p>`;

        return;
      }

      // Create a function to submit the choice
      async function submitChoice() {
          data = {
              yyyymm: yyyyMMContainer.value,
              filename: imageTitle.innerHTML,
              choice: choiceContainer.value,
          };

          const response = await fetch("http://127.0.0.1:5000/", {
              mode: "cors", // dont use "no-cors" !
              method: "POST", 
              headers: {
                  'Accept': 'application/json',
                  'Content-Type': 'application/json',
                  // 'Content-Type': 'application/x-www-form-urlencoded',
              },
              body: JSON.stringify(data), // body data type must match "Content-Type" header
          });
          console.log(response);

          const jsonData = await response.json();
          console.log(jsonData);
          console.log("sent GET");

          responseField.innerHTML = `<p>${jsonData.message}</p>`;
      }

    </script>
  </body>
</html>

